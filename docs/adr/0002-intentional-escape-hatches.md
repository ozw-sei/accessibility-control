# ADR-0002: 意図的な脱出口の設計

- **Status:** Accepted
- **Date:** 2024-12-01
- **Deciders:** @ozawa

## Context

ADR-0001 の二重防御は強力だが、完全なロックアウトはユーザビリティとして危険である。

- ユーザー補助設定へのアクセスが完全に不可能だと、正当な理由（他のアプリの設定変更、端末トラブル対応）で設定変更が必要なときに詰む
- Device Owner はファクトリーリセット以外で解除困難なため、脱出手段がないと端末が使用不能になるリスクがある
- セルフコントロールアプリの目的は「衝動的な行動を防ぐ」ことであり「絶対に不可能にする」ことではない

## Decision

完全なロックアウトではなく「面倒くさいバリア」として、以下の 3 つの意図的な脱出口を設ける。

### 脱出口 1: 許可ウィンドウ

- デフォルト 06:00〜08:00 かつ充電中のときだけ、ユーザー補助設定へのアクセスを許可
- 朝の冷静な時間帯に意図的に操作させることで、衝動的な無効化を防ぐ
- 時間帯・充電条件は `ConditionChecker` 経由で `SharedPreferences` に永続化

### 脱出口 2: ADB 接続での Device Owner 解除

- PC が必要 = 衝動的にはやりにくい（物理的バリア）
- JDWP デバッガ経由で `clearDeviceOwnerApp()` を実行可能
- 手順は CLAUDE.md に記載

### 脱出口 3: Factory Reset

- 全データ消失が抑止力となる最終手段
- Device Owner は端末の初期化で確実に解除される

## Consequences

### Positive

- ユーザーが本当に必要なときは設定を変更できるため、端末が使用不能になるリスクがない
- 各脱出口に異なるレベルの「面倒くささ」があり、衝動的な行動の段階的フィルタとして機能
- 許可ウィンドウはユーザーが自分でカスタマイズ可能で、生活パターンに合わせられる

### Negative

- 許可ウィンドウの存在を知っていれば、その時間帯に意図的に無効化できる（設計上許容）
- 許可ウィンドウの変更自体も許可ウィンドウ内でしか行えないようガードが必要（→ 残タスク）

### Design Note

バリアの強度は「衝動を止める」ために十分で、かつ「本当に必要なときは突破できる」レベルに調整している。これはアルコールの鍵付きキャビネットのメタファーに近い。鍵があれば開けられるが、鍵を取りに行く間に衝動が収まることを期待する設計。
